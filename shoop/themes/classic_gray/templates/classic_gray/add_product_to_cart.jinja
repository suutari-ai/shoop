<div class="cover-wrap">
    <div class="text-wrap">
        <div class="ready">
            <i class="fa fa-check"></i>
            <p>{% trans %}Product added to cart{% endtrans %}</p>
        </div>
        <div class="load">
            <i class="fa fa-spinner fa-spin"></i>
        </div>
        <div class="error-msg">
            <i class="fa fa-warning"></i>
            <p id="error-msg"></p>
        </div>
    </div>
</div>

<script>
    function updateNavigationCart() {
        $.ajax({
            url: "{{ url('shoop:xtheme_extra_view', view='cart_partial') }}",
            method: "GET",
            success: function(cart_html) {
                $("#navigation-cart-partial").html(cart_html);
            }
        });
    }

    function handleError(cover, error) {
        setTimeout(function() {
            // Hide the loader and change to error message
            cover.removeClass("loading").addClass('error');
            cover.find("#error-msg").text(error ? error : "{% trans %}There was an error adding the product to the cart{% endtrans %}");
            setTimeout(function() {
                // Hide the error message and the modal
                cover.removeClass("error in");
            }, 1750);
        }, 500);
    }

    function addToCart(form) {
        var cover = $(".cover-wrap");
        cover.addClass("in loading");
        $.ajax({
            url: form.attr("action"),
            method: "POST",
            data: form.serializeArray(),
            success: function(response) {
                if(response.error) {
                    handleError(cover, response.error);
                    return;
                }

                updateNavigationCart();
                setTimeout(function() {
                    // Hide the loader and show the message
                    cover.removeClass("loading").addClass("loaded");
                    setTimeout(function() {
                        // Hide the message
                        cover.removeClass("loaded");
                        setTimeout(function() {
                            // Hide the modal
                            cover.removeClass("in");
                        }, 250);
                    }, 1500);
                }, 500);


            },
            error: function() {
                handleError(cover);

            }
        });
    }

    $(document).ready(function() {
        $("form.add-to-cart").on("submit", function(e) {
            e.preventDefault();
            addToCart($(this));
        });
    });
</script>
